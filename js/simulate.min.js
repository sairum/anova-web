var ui=function(){'use strict';var a=[],b=[],d=[],c=[],e=[],r=[];function j(){let e=document.getElementById('fname'),f=document.getElementById('levels'),h=document.getElementById('ftype'),d=document.getElementById('nestedin'),i=a.length,c=e.value.trim().replace(/\s/gi,"_");if(c.match(/^[0-9a-z-.+_]+$/i)&&c.length>0){let j=!1;if(a.length>0)for(let b=0;b<a.length;b++)a[b].name==c&&(j=!0);if(j)console.log('good but duplicate name:'+c);else{let j={};j.name=c,j.orig_name=c,j.levels=parseInt(f.value),j.true_levels=j.levels,j.ftype=h.value,j.nestedin=[],j.effects=[],j.lcodes=[...Array(j.levels).keys()],d.value=="-"?j.nested=!1:j.nested=!0;let k=[];if(j.nested){{j.ftype='random',j.name=c+"("+d.value+")";let e=d.value.split(/[(*)]/);e=e.filter(Boolean);for(let b=0;b<e.length;b++){let c=a.find(a=>a.orig_name===e[b]);if(c!==void 0){let b=a.indexOf(c);j.nestedin.push(b),j.true_levels*=c.levels}}j.lcodes=[...Array(j.true_levels).keys()],k.push(j.name);for(let a=0;a<b.length;a++)l(d.value,b[a])&&k.push(b[a]+"*"+j.name)}}else{k.push(c);for(let a=0;a<b.length;a++)k.push(b[a]+"*"+c)}for(let a=0;a<k.length;a++)b.push(k[a]);let o=document.getElementById('model');o.innerHTML="X = &mu; + "+b.join(" + ")+" + &epsilon;",d.disabled=!1;let m;for(let a=0;a<k.length;a++)m=document.createElement('option'),m.value=k[a],m.appendChild(document.createTextNode(k[a])),d.appendChild(m);a.push(j),g(0),n(),q(i),e.value="",f.value=2,h.value='fixed',d.value='-';let p=document.getElementById("generate");p.disabled=!1}}else console.log('bad name:'+c)}function g(b){if(b==0&&(d=[]),b<a.length){typeof e[b]==='undefined'&&(e[b]=0);for(let c=0;c<a[b].levels;c++)e[b]=c,g(b+1)}else{let a=[...e];d.push(a)}}function i(b,c){for(let d=0;d<a.length;d++){a[d].effects=[];for(let e=0;e<a[d].true_levels;e++){let f=jStat.normal.sample(b,c);a[d].effects.push(f-b)}}}function h(){let a=document.getElementById("result").value.trim();var b=new Blob([a],{type:'text/plain;charset=utf-8'});saveAs(b,'results.txt')}function k(){let g=document.getElementById("seed").value,h=parseFloat(document.getElementById("average").value),j=parseFloat(document.getElementById("stdev").value),k=parseInt(document.getElementById("replicates").value);if(g!=""){var l=new Math.seedrandom(g.toString());jStat.setRandom(l)}i(h,j);let b=[],d="",e;for(let c=0;c<a.length;c++){let d=a[c].orig_name;a[c].ftype=='random'&&(d+='*'),b.push(d)}d=b.join(' ')+' DATA\n';for(let f=0;f<c.length;f++){b=[],e=0;for(let d=0;d<a.length;d++){let g=c[f][d];e+=a[d].effects[g],b.push(a[d].lcodes[g])}let g=b.join(' ');for(let a=0;a<k;a++){let b=jStat.normal.sample(h,j);d+=g+' '+(b+e).toString()+'\n'}}let f=document.getElementById("result");f.innerHTML=d,f=document.getElementById("download"),f.disabled=!1,document.getElementById("separator").disabled=!1}function l(b,c){let a=b.split(/[(*)]/).filter(Boolean),d=c.split(/[(*)]/).filter(Boolean);for(let b=0;b<a.length;b++)if(d.indexOf(a[b])!=-1)return!1;return!0}function m(c){let b=c.value.trim().replace(/\s/gi,"_");if(b.match(/^[0-9a-z-.+_]+$/i)&&b.length>0){let d=c.id.split('.'),e=parseInt(d[1]),f=parseInt(d[2]);a[e].lcodes[f]=b}}function n(){c=[...d];for(let a=0;a<c.length;a++)c[a]=[...d[a]];for(let b=0;b<a.length;b++)if(a[b].nested){let j=d.length,e=[];var b=[];let f=a[b].nestedin,g=1,h=1;for(let c=0;c<b;c++){let d=a[c].levels;c>0?e[c]=e[c-1]*d:e[c]=d}for(let c=0;c<a.length;c++)c<b?f.indexOf(c)!=-1&&(h*=a[c].levels):c!=b&&(g*=a[c].levels);b=[...Array(h*a[b].levels).keys()];for(let c=0;c<b;c++)if(f.indexOf(c)==-1){let d=[],f=a[c].levels,h=e[c]/f,i=b.length/h,g=0;for(let a=0;a<h;a++){let c=b.slice(g,g+i);for(let a=0;a<f;a++)for(let a of c)d.push(a);g+=i}let j='Repeating ('+b.join(' ')+') x '+f.toString()+' times: ';j+='('+d.join(' ')+')',b=[...d]}let i=[];for(let a of b)for(let b=0;b<g;b++)i.push(a);for(let a=0;a<c.length;a++)c[a][b]=i[a]}}function o(){a=[],d=[],b=[],e=[],c=[],location.reload()}function f(b){let a=document.getElementsByClassName("tabcontent");for(let c=0;c<a.length;c++)a[c].id==b?a[c].style.display="block":a[c].style.display="none"}function p(){let a=document.getElementById("result").value,b=document.getElementById("separator").value;b=="."?(a=a.replace(/\,/g,"."),document.getElementById("separator").value=",",document.getElementById("separator").innerHTML="Dec. separator = , (comma)"):(a=a.replace(/\./g,","),document.getElementById("separator").value=".",document.getElementById("separator").innerHTML="Dec. separator = . (dot)"),document.getElementById("result").value=a}function q(h){let b=a[h];b.true_levels=b.levels;for(let c=0;c<b.nestedin.length;c++)b.true_levels*=a[b.nestedin[c]].levels;let l=document.getElementById('tabs'),i=document.getElementById('tresults'),e=document.createElement('a');e.name=b.name,e.className='tabs',e.href="#!",e.innerHTML=b.name,e.onclick=function(){f(b.name)},l.insertBefore(e,i);let j=document.getElementById('tab-contents'),k=document.getElementById('results'),g=document.createElement('div');g.className='tabcontent',g.id=b.name;let c='<h3>Labels for levels of Factor '+b.name+'</h3><table>';for(let e=0;e<b.true_levels;e++){if(c+='<tr><td><b>Level '+(e+1).toString(),b.nested){c+='</b> nested in ';let f=[];for(let c=0;c<b.nestedin.length;c++)f.push(' Level '+(d[e][c]+1).toString()+' of Factor '+a[b.nestedin[c]].name);c+=f.join(' and ')}c+='</td><td><input type="text" class="label" value="'+(e+1).toString()+'"',c+=' onchange="ui.label(this)" ',c+=' id="flabel.'+h+'.'+e.toString()+'"></td></tr>'}c+="</table>",g.innerHTML=c,g.style.display='none',j.insertBefore(g,k)}return{addFactor:j,select:f,reset:o,generate:k,download:h,label:m,separator:p}}();document.addEventListener('DOMContentLoaded',function(){document.getElementById("results").style.display="none",chart.render(),document.getElementById("average").addEventListener("change",function(){chart.setAverage(this.value)}),document.getElementById("stdev").addEventListener("change",function(){chart.setStdev(this.value)})})